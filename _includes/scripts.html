<script>
  (function () {
    try {
      // 常见主题缓存 key（不同主题实现可能不同，多清几个没副作用）
      localStorage.removeItem("theme");
      localStorage.removeItem("color-scheme");
      localStorage.removeItem("mm-theme");
      localStorage.removeItem("appearance");
    } catch (e) {}

    // 强制回到 light
    document.documentElement.removeAttribute("data-theme");
    document.documentElement.classList.remove("dark");
    document.documentElement.style.colorScheme = "light";
  })();
</script>

<script type="module" src="{{ base_path }}/assets/js/main.min.js"></script>

<script type="module" src="{{ base_path }}/assets/js/main.min.js"></script>

<script>
/**
 * Fix: Mobile portrait nav overflow / half-cut menu text
 * Cause: GreedyNav width calc can be wrong before fonts/layout settle (esp. iOS + webfonts + orientation changes)
 * Action: trigger resize recalculation at key moments
 */
(function () {
  let queued = false;

  function recalcGreedyNav() {
    if (queued) return;
    queued = true;
    requestAnimationFrame(function () {
      queued = false;
      window.dispatchEvent(new Event("resize"));
    });
  }

  // After full load
  window.addEventListener("load", function () {
    setTimeout(recalcGreedyNav, 0);
  });

  // iOS Safari bfcache restore
  window.addEventListener("pageshow", function () {
    setTimeout(recalcGreedyNav, 0);
  });

  // After fonts are ready (important when using CN fonts / webfonts)
  if (document.fonts && document.fonts.ready) {
    document.fonts.ready.then(function () {
      setTimeout(recalcGreedyNav, 0);
    });
  }

  // Orientation change (portrait/landscape)
  window.addEventListener("orientationchange", function () {
    setTimeout(recalcGreedyNav, 250);
  });

  // Visual viewport changes (iOS address bar, safe-area changes)
  if (window.visualViewport) {
    window.visualViewport.addEventListener("resize", function () {
      setTimeout(recalcGreedyNav, 50);
    });
  }
})();
</script>

{% include analytics.html %}
